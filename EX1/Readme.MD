# ğŸš€ EX1 â€“ Express + Prisma + PostgreSQL + Docker

## ğŸ§© Giá»›i thiá»‡u

ÄÃ¢y lÃ  má»™t project máº«u sá»­ dá»¥ng **Express.js** lÃ m backend framework, **Prisma ORM** Ä‘á»ƒ tÆ°Æ¡ng tÃ¡c cÆ¡ sá»Ÿ dá»¯ liá»‡u **PostgreSQL**, vÃ  **Docker Compose** Ä‘á»ƒ dá»… dÃ ng cháº¡y toÃ n bá»™ mÃ´i trÆ°á»ng.

Cáº¥u trÃºc Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ:

- Dá»… phÃ¡t triá»ƒn vÃ  triá»ƒn khai
- Há»— trá»£ tÃ¡ch biá»‡t mÃ´i trÆ°á»ng **local** vÃ  **Docker**
- Tá»± Ä‘á»™ng cháº¡y migration vÃ  seed khi khá»Ÿi Ä‘á»™ng container

---

## âš™ï¸ CÃ´ng nghá»‡ sá»­ dá»¥ng

| ThÃ nh pháº§n                  | PhiÃªn báº£n / MÃ´ táº£          |
| --------------------------- | -------------------------- |
| **Node.js**                 | 18 (Alpine)                |
| **Express.js**              | Backend framework          |
| **Prisma ORM**              | ORM hiá»‡n Ä‘áº¡i cho Node.js   |
| **PostgreSQL**              | CÆ¡ sá»Ÿ dá»¯ liá»‡u              |
| **Docker & Docker Compose** | Quáº£n lÃ½ mÃ´i trÆ°á»ng dá»… dÃ ng |
| **dotenv**                  | Quáº£n lÃ½ biáº¿n mÃ´i trÆ°á»ng    |

---

## ğŸ—ï¸ Cáº¥u trÃºc thÆ° má»¥c

â”œâ”€â”€ prisma/
â”‚ â”œâ”€â”€ schema.prisma # Äá»‹nh nghÄ©a model & datasource
â”‚ â”œâ”€â”€ seed.js # Dá»¯ liá»‡u máº«u (seed)
â”‚
â”œâ”€â”€ src/
â”‚ â”œâ”€â”€ controllers/
â”‚ â”œâ”€â”€ routes/
â”‚ â”œâ”€â”€ services/
â”‚ â”œâ”€â”€ app.js
â”‚ â”œâ”€â”€ server.js # Entry chÃ­nh cá»§a á»©ng dá»¥ng
â”‚
â”œâ”€â”€ Dockerfile # Cáº¥u hÃ¬nh build á»©ng dá»¥ng
â”œâ”€â”€ docker-compose.yml # Cháº¡y app + PostgreSQL
â”œâ”€â”€ .env # Biáº¿n mÃ´i trÆ°á»ng
â”œâ”€â”€ package.json
â””â”€â”€ README.md

---

## ğŸ”§ Cáº¥u hÃ¬nh `.env`

Táº¡o file `.env` á»Ÿ thÆ° má»¥c gá»‘c cá»§a project vá»›i ná»™i dung sau:

```env
# Cáº¥u hÃ¬nh cho mÃ´i trÆ°á»ng local
DATABASE_URL="postgresql://postgres:root@localhost:5432/prisma_db?schema=public"
PORT=3000
```

> âš ï¸ **LÆ°u Ã½:**  
> Khi cháº¡y á»©ng dá»¥ng báº±ng **Docker**, tá»‡p **docker-compose.yml** sáº½ tá»± Ä‘á»™ng cung cáº¥p biáº¿n mÃ´i trÆ°á»ng `DATABASE_URL` vÃ o container.
>
> Nhá» Ä‘Ã³, báº¡n **khÃ´ng cáº§n chá»‰nh sá»­a file `.env`** cho Docker â€” á»©ng dá»¥ng sáº½ tá»± káº¿t ná»‘i Ä‘áº¿n PostgreSQL ná»™i bá»™ trong máº¡ng Docker (qua host `db:5432`).

---

## ğŸ³ Cháº¡y á»©ng dá»¥ng vá»›i Docker

### 1ï¸âƒ£ Build vÃ  khá»Ÿi Ä‘á»™ng container

```bash
npm run build
```

Lá»‡nh nÃ y thá»±c cháº¥t tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i:

```bash
docker compose up --build
```

Docker sáº½ tá»± Ä‘á»™ng:

- Build image Node.js vÃ  PostgreSQL
- CÃ i Ä‘áº·t dependencies
- Cháº¡y migration vÃ  seed dá»¯ liá»‡u
- Má»Ÿ port `3000` cho á»©ng dá»¥ng

Sau khi hoÃ n táº¥t, á»©ng dá»¥ng sáº½ cháº¡y táº¡i:  
ğŸ‘‰ [http://localhost:3000](http://localhost:3000)

---

### 2ï¸âƒ£ Cháº¡y láº¡i sau khi Ä‘Ã£ build

Khi image Ä‘Ã£ Ä‘Æ°á»£c build sáºµn, chá»‰ cáº§n:

```bash
docker compose up
```

Hoáº·c náº¿u muá»‘n rebuild toÃ n bá»™ tá»« Ä‘áº§u (bao gá»“m xÃ³a container cÅ©):

```bash
docker compose up --build --force-recreate
```

---

### 3ï¸âƒ£ Dá»«ng vÃ  xoÃ¡ container

```bash
docker compose down
```

Náº¿u muá»‘n xoÃ¡ luÃ´n dá»¯ liá»‡u database (volume):

```bash
docker compose down -v
```

---

## ğŸ§  Cháº¡y á»©ng dá»¥ng local (khÃ´ng dÃ¹ng Docker)

1. Äáº£m báº£o PostgreSQL Ä‘ang cháº¡y á»Ÿ local (`localhost:5432`)
2. Cáº­p nháº­t file `.env` cho Ä‘Ãºng connection string
3. CÃ i Ä‘áº·t dependencies:
   ```bash
   npm install
   ```
4. Cháº¡y migration vÃ  seed dá»¯ liá»‡u:
   ```bash
   npx prisma migrate dev --name init
   node prisma/seed.js
   ```
5. Khá»Ÿi Ä‘á»™ng server:
   ```bash
   npm run dev
   ```

---

## ğŸ§° CÃ¡c lá»‡nh há»¯u Ã­ch

| Lá»‡nh                | MÃ´ táº£                                                  |
| ------------------- | ------------------------------------------------------ |
| `npm run dev`       | Cháº¡y á»©ng dá»¥ng á»Ÿ cháº¿ Ä‘á»™ phÃ¡t triá»ƒn (nodemon)            |
| `npm start`         | Cháº¡y á»©ng dá»¥ng á»Ÿ cháº¿ Ä‘á»™ production                      |
| `npm run build`     | Build vÃ  khá»Ÿi Ä‘á»™ng toÃ n bá»™ há»‡ thá»‘ng báº±ng Docker        |
| `npm run clean`     | XÃ³a node_modules, cache npm, vÃ  cÃ i láº¡i dependencies   |
| `npx prisma studio` | Giao diá»‡n web Ä‘á»ƒ xem vÃ  quáº£n lÃ½ dá»¯ liá»‡u trong database |

---

## ğŸ§© Prisma CLI há»¯u Ã­ch

Má»™t sá»‘ lá»‡nh Prisma thÆ°á»ng dÃ¹ng:

```bash
# Cháº¡y migration
npx prisma migrate dev --name init

# Cáº­p nháº­t Prisma Client khi thay Ä‘á»•i schema
npx prisma generate

# Truy cáº­p giao diá»‡n Prisma Studio
npx prisma studio
```

---

## ğŸª„ Gá»£i Ã½ má»Ÿ rá»™ng

- TÃ¡ch `.env.local` vÃ  `.env.docker` Ä‘á»ƒ dá»… quáº£n lÃ½ biáº¿n mÃ´i trÆ°á»ng giá»¯a local vÃ  container.
- CÃ³ thá»ƒ dÃ¹ng thÆ° viá»‡n [dotenv-flow](https://www.npmjs.com/package/dotenv-flow) Ä‘á»ƒ tá»± Ä‘á»™ng chá»n file `.env` tÆ°Æ¡ng á»©ng.
- TÃ­ch há»£p thÃªm `Swagger` Ä‘á»ƒ tá»± Ä‘á»™ng sinh API docs.
- ThÃªm `Jest` hoáº·c `Vitest` cho unit testing.

---

## âœ¨ TÃ¡c giáº£

ğŸ‘¨â€ğŸ’» **Kyte Hoang**  
ğŸ“§ Email: [your-email@example.com]  
ğŸŒ GitHub: [https://github.com/yourusername](https://github.com/yourusername)

---

## ğŸ“œ Giáº¥y phÃ©p

PhÃ¡t hÃ nh theo giáº¥y phÃ©p **MIT License Â© 2025 Kyte Hoang**
